<div class="mt-2 flex flex-wrap content-center">
    <!-- Add product button -->
    <button
        class="ml-4"
        mat-flat-button
        [color]="'primary'"
        (click)="backTolistSaleNote()">
        <mat-icon [svgIcon]="'heroicons_outline:arrow-sm-left'"></mat-icon>
        <span class="ml-2 mr-1">Regresar a lista nota de ventas</span>
    </button>
      <!-- Loader -->
<!--         <div
            class="absolute inset-x-0 bottom-0"
            *ngIf="true">
        <mat-progress-bar [mode]="'indeterminate'"></mat-progress-bar>
        </div> -->
</div>

<!-- Main -->
<cdk-virtual-scroll-viewport itemSize="50" [style.height]="getScreenSize().HeightWindows" class=" relative flex flex-col sm:flex-row flex-0 sm:items-center sm:justify-between py-2 px-1 md:px-1 border-b">
      
    <!-- documentSeries list -->
    
        <div class="flex flex-col w-full" [formGroup]="selectedSaleNoteForm">
            <div class="relative flex-row flex-0 mx-4 px-4 pt-4 pb-0">
                <div class="relative flex flex-0 ">
                    <div class="w-4/12">
                        <mat-form-field class="pr-2" style="width: 100%;" >
                            <mat-label>Cliente</mat-label>
                            <input
                                [imask]="maskForInput"
                                matInput
                                [formControlName]="'client'">
                        </mat-form-field>
                    </div>
                    <div class="w-4/12 pr-2">
                        <app-select-search *ngIf="listObjCompanies.length > 0" [labelTop]= "'Empresa'" [listObj] = "listObjCompanies" 
                            [placeholder]="'empresa'" [placeholderLabel]="'Buscar empresa'" [id]= "selectedSaleNoteForm.get('company').value"  
                            [noEntriesFoundLabel]="'empresa no encontrada'" (objSelectedOut)="objCompanySelected($event)"  > 
                        </app-select-search>   
                    </div>
                    <div class="w-4/12">
                        <app-select-search *ngIf="listObjDocuments.length > 0" [labelTop]= "'Documento'" [listObj] = "listObjDocuments" 
                            [placeholder]="'documento'" [placeholderLabel]="'Buscar documento'" [id]= "selectedSaleNoteForm.get('document').value"
                            [noEntriesFoundLabel]="'documento no encontrado'" (objSelectedOut)="objDocumentSelected($event)"  > 
                        </app-select-search>
                    </div>

                </div>
                <div class="relative flex flex-0 ">
                    <div class="w-4/12">
                        <mat-form-field class="pr-2" style="width: 100%;" appearance="fill">
                            <mat-label>Serie</mat-label>
                            <input
                                [imask]="maskForInput"
                                matInput
                                [formControlName]="'serie'">
                        </mat-form-field>
                    </div>
                    <div class="w-4/12">
                        <mat-form-field class="pr-2" style="width: 100%;" appearance="fill">
                            <mat-label>Número de documento</mat-label>
                            <input
                                matInput
                                [formControlName]="'documentNumber'">
                        </mat-form-field>
                    </div>
                    <div class="w-4/12">
                        <app-select-search *ngIf="listObjPaymentDeadlines.length > 0" [labelTop]= "'Plazo de pago'" [listObj] = "listObjPaymentDeadlines" 
                            [placeholder]="'plazo de pago'" [placeholderLabel]="'Buscar plazo de pago'" [id]= "selectedSaleNoteForm.get('paymentdeadline').value"
                            [noEntriesFoundLabel]="'plazo de pago no encontrado'" (objSelectedOut)="objPaymentDeadlineSelected($event)"  > 
                        </app-select-search>
                    </div>
                </div>
                <div class="relative flex flex-0 ">
                    <div class="w-4/12">
                        <mat-form-field class="pr-2" style="width: 100%;" appearance="fill">
                            <mat-label>Estado</mat-label>
                            <input
                                [imask]="maskForInput"
                                matInput
                                [formControlName]="'status'">
                        </mat-form-field>
                    </div>
                    <div class="w-4/12">
                        <mat-form-field class="pr-2" style="width: 100%;" appearance="fill">
                            <mat-label>Referencia</mat-label>
                            <input
                                [imask]="maskForInput"
                                matInput
                                [formControlName]="'reference'">
                        </mat-form-field>
                    </div>
                    <div class="w-4/12">
                        <mat-form-field class="pr-2" style="width: 100%;" appearance="fill">
                            <mat-label>Nota</mat-label>
                            <input
                                [imask]="maskForInput"
                                matInput
                                [formControlName]="'note'">
                        </mat-form-field>
                    </div>
                </div>
                <div *ngIf="salesNoteInput"  class="relative flex flex-0 ">
                    <div class="w-4/12">
                        <mat-form-field class="pr-2" style="width: 100%;" appearance="fill">
                            <mat-label>Fecha de emisión</mat-label>
                            <input
                                matInput
                                [formControlName]="'registryDate'">
                        </mat-form-field>
                    </div>
                    <div class="w-4/12">
                        <mat-form-field class="pr-2" style="width: 100%;" appearance="fill">
                            <mat-label>Fecha de modificación</mat-label>
                            <input
                                matInput
                                [formControlName]="'updatedAt'">
                        </mat-form-field>
                    </div>
                </div>
                
            </div>
            <div class="relative flex-row flex-0 mx-2 p-0">
                <div class="relative flex flex-0 ml-6">
                    <div class="text-2xl font-extrabold tracking-tight">Datos del voucher</div>
                </div>
                <div class="relative flex flex-0 ml-6 my-2">
                    <button
                        mat-flat-button
                        [color]="'primary'"
                        (click)="addItem()">
                        <span >
                            Agregar item
                        </span>
                    </button>
                </div>
                <div class="relative flex flex-0 ">
                    <ng-container *ngIf="true ; else noSaleNote">
                        <div class="grid">
                            <!-- Header -->
                            <div
                                class="inventory-grid z-10 sticky top-0 grid gap-4 py-4 px-6 md:px-8 shadow text-md font-semibold text-secondary bg-gray-50 dark:bg-black dark:bg-opacity-5"
                                matSort
                                matSortDisableClear>
        
                                <div 
                                    class="hidden md:block"
                                    [mat-sort-header]="'sku'">
                                    SKU
                                </div>
                                <div
                                    class="hidden sm:block"
                                    [mat-sort-header]="'productname'">
                                    Nombre de producto
                                </div>
                                <div
                                    class="hidden lg:block"
                                    [mat-sort-header]="'quantity'">
                                    Cantidad
                                </div>
                                <div
                                    class="hidden lg:block"
                                    [mat-sort-header]="'netprice'">
                                    Precio neto (S/.)
                                </div>
                                <div
                                    class="hidden lg:block"
                                    [mat-sort-header]="'igvprice'">
                                    Precio IGV (S/.)
                                </div>
                                <div
                                    style="text-align: right;"
                                    class="hidden lg:block"
                                    [mat-sort-header]="'totalprice'">
                                    <span>Precio total (S/.)</span>
                                    
                                </div>
                                <!-- <div class="hidden sm:block">Detalles</div> -->
                            </div>
                            <!-- Rows -->
                            <ng-container *ngIf="salesNoteInput">
                                <ng-container *ngFor="let voucher of salesNoteInput?.voucherDetail; trackBy: trackByFn">
                                    <div class="hightlightRow inventory-grid grid items-center gap-4 py-3 px-6 md:px-8 border-b">
                                        <div class="truncate">
                                            {{voucher.sku}}
                                        </div>
                                        <div class="truncate">
                                            <span [matTooltip]="voucher.name" >
                                                 {{voucher.name}} 
                                            </span>
                                        </div>
                                      
                                        <div class="truncate pr-1" style="text-align: right;">
                                            {{voucher.quantity}}
                                        </div>
                                       
                                        <div class="truncate pr-5" style="text-align: right;">
                                            {{voucher.brutoAmountNC | number:'1.2-2'}}
                                        </div>
                                        <div class="truncate pr-5" style="text-align: right;">
                                            {{voucher.igvAmountNC | number:'1.2-2'}}
                                        </div>
                                        
                                        <div class="truncate pr-5" style="text-align: right;">
                                            {{voucher.totalAmountNC | number:'1.2-2'}}
                                        </div>
                                    </div>    
                                </ng-container>
                            </ng-container> 
                                <div *ngIf="salesNoteInput?.voucherDetail.length > 0" class="flex justify-end mt-4 " >
                                    <div class="borderRounded  flex flex-col w-2/5">
                                        <div class="relative flex-row flex-0 mx-2 p-0">
                                            <div class="relative flex flex-0 ">
                                                <div class="w-7/12">
                                                    <span>Precio neto total</span>
                                                </div>
                                                <div class="w-5/12" style="text-align: right;">
                                                    <span>S/. {{salesNoteInput?.brutoTotalNC || 0 | number:'1.2-2'}}</span>
                                                </div>
                                            </div>
                                            <div class="relative flex flex-0 ">
                                                <div class="w-7/12">
                                                    <span>Precio IGV total</span>
                                                </div>
                                                <div class="w-5/12" style="text-align: right;">
                                                    <span>S/. {{salesNoteInput?.igvTotalNC || 0  | number:'1.2-2'}}</span>
                                                </div>
                                            </div>
                                            <div class="relative flex flex-0 ">
                                                <div class="w-7/12">
                                                    <span>Precio venta total</span>
                                                </div>
                                                <div class="w-5/12" style="text-align: right;">
                                                    <span>S/. {{salesNoteInput?.salesTotalNC || 0  | number:'1.2-2'}}</span>
                                                </div>
                                            </div>
                                    
                                        </div>
                                        
                                    </div>
                             
                                </div>
                                <div  *ngIf="salesNoteInput?.voucherDetail.length > 0" class="flex justify-end mt-4">
                                    <div class=" flex flex-col w-2/5 ">
                                        <div class="relative flex-row flex-0 mx-2 p-0">
                                            <div class="relative flex flex-0 justify-end">
                                                <div  class="w-4/12">
                                                    <button
                                                        class="-ml-4"
                                                        mat-button
                                                        [color]="'warn'"
                                                        (click)="cancelSelectedSaleNote()">
                                                        Cancelar
                                                    </button>
                                                </div>
                                                <div  class="w-4/12">
                                                    <button
                                                        *ngIf="salesNoteInput"
                                                        mat-flat-button
                                                      
                                                        [color]="'primary'"
                                                        (click)="saveSelectedSaleNote()">
                                                        <span *ngIf="isLoading">
                                                            Guardar
                                                        </span>
                                                        <mat-progress-spinner
                                                        *ngIf="!isLoading"
                                                        [diameter]="22"
                                                        [mode]="'indeterminate'"></mat-progress-spinner>
                                                    </button>
                                                    <button
                                                        *ngIf="!salesNoteInput"
                                                        mat-flat-button
                                                    
                                                        [color]="'primary'"
                                                        (click)="createSaleNote()">
                                                        <span *ngIf="isLoading">
                                                            Registrar nueva
                                                        </span>
                                                        <mat-progress-spinner
                                                        *ngIf="!isLoading"
                                                        [diameter]="22"
                                                        [mode]="'indeterminate'"></mat-progress-spinner>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                        </div>
    
                    </ng-container>
                    <ng-template #noSaleNote>
                        <div class="p-8 sm:p-16 border-t text-4xl font-semibold tracking-tight text-center">No hay items!</div>
                    </ng-template>

                </div>
            </div>
           
        </div>
        
</cdk-virtual-scroll-viewport>